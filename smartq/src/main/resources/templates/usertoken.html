<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Live Token Status | SmartQ</title>
    <meta http-equiv="refresh" content="15"> 
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8fafc; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .token-card { background: white; border-radius: 20px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05); width: 100%; max-width: 450px; overflow: hidden;}
        .card-header-custom { padding: 2rem 1.5rem; text-align: center; color: white; }
        
        .bg-waiting { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .bg-active { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .bg-done { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); } /* Blue for Billing */

        .token-circle { background: white; width: 120px; height: 120px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: -60px auto 20px auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .token-value { font-size: 3rem; font-weight: 700; color: var(--text-dark); line-height: 1; }
        .details-box { background: #f0fdfa; border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem; }
        .detail-row { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #e2e8f0; }
        .detail-row:last-child { border-bottom: none; }
    </style>
</head>
<body>

<div class="container p-3">
    <div class="row justify-content-center">
        <div class="col-12 d-flex justify-content-center">
            
            <div class="token-card">
                
                <div class="card-header-custom"
                     th:classappend="${token.consultationStatus.name() == 'IN_CONSULTATION'} ? 'bg-active' : 
                                     (${token.consultationStatus.name() == 'COMPLETED'} ? 'bg-done' : 'bg-waiting')">
                    
                    <h5 class="fw-bold mb-1"><i class="fas fa-hospital-user me-2"></i>SmartQ Queue</h5>
                    <p class="small opacity-75 mb-5" th:text="${#dates.format(token.scheduledTime, 'hh:mm a')}">Time</p>
                </div>

                <div class="card-body px-4 pb-4">
                    
                    <div class="token-circle">
                        <span class="small text-muted text-uppercase">Token</span>
                        <span class="token-value" th:text="${token.tokenNumber}">00</span>
                    </div>

                    <div class="text-center mb-4">
                        <div th:if="${token.consultationStatus.name() == 'COMPLETED'}">
                            <h3 class="text-primary fw-bold">Consultation Done</h3>
                            <p class="text-muted">Please proceed to Billing Counter.</p>
                        </div>
                        <div th:if="${token.consultationStatus.name() == 'IN_CONSULTATION'}">
                            <h3 class="text-success fw-bold">It's Your Turn!</h3>
                            <p class="text-muted">Please enter the cabin.</p>
                        </div>
                        <div th:if="${token.consultationStatus.name() == 'WAITING'}">
                            <h3 class="text-warning fw-bold">Please Wait</h3>
                            <p class="text-muted">Doctor is currently busy.</p>
                        </div>
                    </div>

                    <div class="details-box">
                        <div class="detail-row">
                            <span class="text-muted">Patient</span>
                            <span class="fw-bold" th:text="${token.user.username}">User</span>
                        </div>
                        <div class="detail-row">
                            <span class="text-muted">Doctor</span>
                            <span class="fw-bold" th:text="'Dr. ' + ${doctor.username}">Dr. Name</span>
                        </div>
                        <div class="detail-row" th:if="${token.consultationStatus.name() == 'WAITING'}">
                            <span class="text-muted">Est. Wait Time</span>
                            <span class="fw-bold text-danger" th:text="${estTime} + ' Mins'">0 Mins</span>
                        </div>
                    </div>

                    <button onclick="location.reload();" class="btn btn-outline-dark w-100 rounded-pill">Refresh Status</button>
                    <div class="text-center mt-3">
                         <a th:href="@{/user/userhome(userId=${userId})}" class="text-decoration-none text-secondary">Back to Dashboard</a>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>

</body>
</html>